{% comment %}
    Feed listing for blogs, podcasts, or other post types
    This page uses the following parameters via include variables:

    *** REQUIRED:
    feed-type:      The "category" of post to use, which is found on the post itself
    (feedType)      agile-blog and agile-in-action-podcast are two common categories
    (ft)

    caption-image:  default image for any item displayed in the feed
    (captionImage)  Important: The caption-image MUST be square
    (ci)            or it will not display properly (ex 250x250 or 100x100).
                    If a featured image is available, then display that and 
                    ignore the caption image.

    feed-glyph:     default glyph (small icon) to display on top
    (feedGlyph)     of the feed's featured image.
    (fg)            examples: paper icon for a blog, volume for a podcast

    css-style:      the <main> style that will be used to display the feed
    (cssStyle)      The feed can be used to display one or many posts,
    (cs)            so you might want a different layout.
    
    *** OPTIONAL:
    display-offset: tells the feed how many posts to skip.
    (displayOffset) Default is 0 (zero)
    (do)            If 0, then start by displaying the first blog post.
                    If 1, then start by displaying the second blog post.
                    You can use any positive integer.

    display-limit:  determines how many posts to display.
    (displayLimit)  Default is null (display all posts based on the offset)
    (dl)            1 displays a single post.
                    5 displays 5 posts.
                    You can use any positive integer.
{% endcomment %}
{%- assign feed-type = include.feedType -%}
{%- assign caption-image = include.captionImage -%}
{%- assign feed-glyph = include.feedGlyph -%}
{%- assign css-style = include.cssStyle -%}
{%- assign display-offset = include.displayOffset -%}
{%- assign display-limit = include.displayLimit -%}
<section class="{{css-style}}">
    {%- assign feedPosts = site.posts | where: 'categories', feed-type -%}
    {%- for post in feedPosts offset: display-offset limit: display-limit -%}
        <div class="feed-card">
            <div class="feed-card-image">
                {% comment %} Display the post's featured image. {% endcomment %}
                {%- if post.featuredImage == "" or post.featuredImage == nil -%}
                    <!-- No featured image provided, so get it from the referring html file. -->
                    <img class="feed-item-image" src="{{- caption-image | relative_url -}}" alt="{{- post.title -}}">
                {%- else -%}
                    {% comment %} There is a featured image, so use that {% endcomment %}
                    <img class="feed-item-image" src="{{- post.featuredImage | relative_url }}" alt="{{- post.title -}}">
                {%- endif -%}
            </div>
            {% comment %} Where defined in the CSS, add a gradient over the image {% endcomment %}
            <div class="feed-card-gradient-overlay"></div>
            {% comment %} Get an icon (glyph) image to display with the card {% endcomment %}
            {% comment %} <div class="feed-card-icon">
                {%- assign icon-url = "" -%}
                {%- for item in site.data.feed-icons.items -%}
                    {%- if item.title == feed-type -%}
                        {%- assign icon-url = item.url | relative_url -%}
                        <img class="feed-item-icon" src="{{- icon-url -}}" alt="{{feed-type}}" >
                    {%- endif -%}
                {%- endfor -%}
            </div> {% endcomment %}
            <div class="feed-card-glyph">
                <img class="feed-item-glyph" src="{{- feed-glyph -}}" alt="{{feed-type}}" >
            </div>
            <div class="feed-card-content">
                {%- comment -%}Display the post's title{%- endcomment -%}
                <div class="feed-card-title">
                    <span class="feed-item-title"><a class="feed-item-link" href="{{- post.url | relative_url -}}">{{- post.title | escape -}}</a></span>
                </div>
                {%- comment -%}display the post's excerpt text{%- endcomment -%}
                <div class="feed-card-excerpt">
                    {% comment %} Excerpt text should be plain text {% endcomment %}
                    {%- assign miniExcerpt = post.excerpt -%}
                    {%- assign miniExcerpt = miniExcerpt | strip_html -| escape | lstrip | rstrip -%}
                    {%- assign miniExcerpt = miniExcerpt | split: ". " | first -%}
                    {%- assign miniExcerpt = miniExcerpt | append: "." -%}
                    <span class="feed-item-excerpt">{{- miniExcerpt -}}</span>
                </div>
                {% comment %} display the post's author. Use default if necessary. {% endcomment %}
                <div class="feed-card-author">
                    <span class= "feed-item-author">{{ site.author }} - {{ post.date | date: "%A, %B %d, %Y"}}</span>
                </div>
            </div>
        </div>
    {%- endfor -%}
</section>
